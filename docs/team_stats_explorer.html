<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Team Statistics Explorer ‚Äî Universal Win% Correlations</title>
  <script src="https://cdn.jsdelivr.net/npm/d3@7"></script>
  <style>
    :root {
      --red: #ef4444;
      --blue: #0ea5e9;
      --grid: #e8eaed;
      --axis: #9aa0a6;
      --text: #222;
    }
    body { margin: 16px; font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; color: var(--text); background: #f7f7f7; }
    .container { max-width: 1200px; margin: 0 auto; background: #fff; border: 1px solid #e5e5e5; border-radius: 10px; padding: 12px 16px 22px; box-shadow: 0 1px 3px rgba(0,0,0,.06); }
    h1 { margin: 0 0 10px; font-size: 22px; }
    .subtitle { color: #666; font-size: 13px; margin: 4px 0 12px; }
    .panel { margin: 12px 0 14px; border: 1px solid #e5e5e5; border-radius: 10px; overflow: hidden; background: #fff; }
    .panel > summary { padding: 10px 14px; background: #f5f7fa; border-bottom: 1px solid #ebeff5; font-weight: 600; cursor: pointer; user-select: none; list-style: none; }
    .panel[open] > summary { border-bottom-color: #e6eaf0; }
    .chart-wrap { padding: 8px 8px 0; }
    .legend { display: flex; align-items: center; gap: 16px; color: #555; font-size: 12px; padding: 0 10px 10px; }
    .swatch { display: inline-block; width: 12px; height: 12px; border-radius: 2px; margin-right: 6px; vertical-align: middle; }
    .avg { background: repeating-linear-gradient(90deg, #bbb, #bbb 2px, transparent 2px, transparent 6px); border: 1px solid #bbb; }
    .red { background: var(--red); opacity: .5; }
    .blue { background: var(--blue); opacity: .5; }
    .tooltip { position: absolute; pointer-events: none; background: rgba(0,0,0,.78); color: #fff; padding: 6px 8px; border-radius: 6px; font-size: 12px; z-index: 10; }
    .correlation-badge { display: inline-block; padding: 2px 8px; border-radius: 4px; font-size: 11px; font-weight: 600; }
    .corr-strong { background: #dcfce7; color: #166534; }
    .corr-moderate { background: #fef3c7; color: #854d0e; }
    .corr-weak { background: #fee2e2; color: #991b1b; }
    .help-icon { display: inline-block; width: 16px; height: 16px; border-radius: 50%; background: #3b82f6; color: white; text-align: center; line-height: 16px; font-size: 11px; font-weight: bold; margin-left: 8px; cursor: help; vertical-align: middle; }
    .metric-tooltip { position: absolute; pointer-events: none; background: rgba(30,64,175,.95); color: #fff; padding: 8px 12px; border-radius: 6px; font-size: 12px; z-index: 100; max-width: 350px; line-height: 1.5; box-shadow: 0 4px 6px rgba(0,0,0,.3); }
  </style>
  <script>
    async function tryCsv(paths) {
      let lastErr;
      for (const p of paths) {
        try { return await d3.csv(p, d3.autoType); } catch (e) { lastErr = e; }
      }
      throw lastErr || new Error('Unable to load CSV: ' + paths.join(', '));
    }

    function toPct(x) { return d3.format('.1%')(x); }
    function fmt2(x) { return d3.format('.2f')(x); }
    function fmt3(x) { return d3.format('.3f')(x); }

    function regression(points) {
      let n = 0, sx = 0, sy = 0, sxy = 0, sxx = 0, syy = 0;
      for (const [x0, y0] of points) {
        const x = +x0, y = +y0;
        if (!Number.isFinite(x) || !Number.isFinite(y)) continue;
        n++; sx += x; sy += y; sxy += x*y; sxx += x*x; syy += y*y;
      }
      if (n < 2) return { m: 0, b: sy / (n || 1), r2: 0 };
      const denom = n * sxx - sx * sx;
      const m = denom !== 0 ? (n * sxy - sx * sy) / denom : 0;
      const b = (sy - m * sx) / n;
      
      const ssr = points.reduce((sum, [x0, y0]) => {
        const x = +x0, y = +y0;
        if (!Number.isFinite(x) || !Number.isFinite(y)) return sum;
        return sum + Math.pow(y - (m * x + b), 2);
      }, 0);
      const sst = syy - (sy * sy) / n;
      const r2 = sst !== 0 ? Math.max(0, 1 - ssr / sst) : 0;
      
      return { m, b, r2 };
    }

    const METRICS = [
        { key: 'pass_yds_per_att', label: 'Pass Yards per Attempt', format: fmt2, higherBetter: true, help: 'Durchschnittliche Yards pro Passversuch. Misst die Effizienz des Passspiels ‚Äì je h√∂her, desto besser die Qualit√§t der P√§sse.', quadrantHelp: { topRight: 'High pass Y/A + high win%: Elite passing efficiency driving victories. QB and receivers in sync with consistent explosive plays. Defense must respect vertical threat. Modern offensive success formula', topLeft: 'High pass Y/A but low win%: Passing efficiency not translating to wins. Potential issues include poor defense, red zone struggles, or inability to sustain drives despite explosive plays', bottomLeft: 'Low pass Y/A + low win%: Ineffective passing attack correlating with losses. Limited deep threat allows defense to compress field. Third down conversion issues. Offense lacks explosive capability', bottomRight: 'Low pass Y/A but high win%: Winning through defense and running game. Play-action effectiveness on limited attempts. Time of possession control compensates for passing limitations' } },
        { key: 'rush_yds_per_att', label: 'Rush Yards per Attempt', format: fmt2, higherBetter: true, help: 'Durchschnittliche Yards pro Lauf. Zeigt die Effizienz des Laufspiels und die Qualit√§t der Offensive Line.', quadrantHelp: { topRight: 'üèÜ Panzerdivision: 4.5+ Y/A und Siege = O-Line rei√üt L√ºcken so gro√ü wie LKW. RB f√§llt immer nach vorne, 2nd&short ist normal. Verteidigung wird im 4. Viertel m√ºde von den st√§ndigen Treffern. Zeit- und Feldpositionskontrolle', topLeft: 'ü§î Lauf ins Leere: 5+ Y/A, aber verlieren = RB macht Yards, aber es wird nicht umgesetzt. Vielleicht geben sie den Lauf zu fr√ºh auf oder k√∂nnen in der Red Zone nicht punkten. Turnovers zerst√∂ren gute Drives', bottomLeft: 'üòî Wand voraus: <3.5 Y/A und Niederlagen = O-Line verliert in den Gr√§ben. RB tanzt hinter der Linie auf der Suche nach einer L√ºcke, die nicht da ist. 3rd&long in jeder Serie, vorhersehbare Pass-Situationen. Verteidigung r√ºckt auf', bottomRight: 'üí™ Air Raid kompensiert: Siegen mit <4 Y/A = wer braucht schon das Laufspiel, wenn der QB 40 TDs wirft? Schnelles Passspiel neutralisiert den Pass Rush, RB wird als Receiver eingesetzt. Moderner Ansatz' } },
        { key: 'qb_rating', label: 'QB Rating', format: fmt2, higherBetter: true, help: 'Komplexes QB-Rating (0-158). Ber√ºcksichtigt Completion %, Yards, TDs und INTs. √úber 100 = exzellent, unter 80 = schlecht.', quadrantHelp: { topRight: 'üèÜ Franchise QB: Rating 105+ und Siege = QB spielt auf MVP-Niveau. Liest die Verteidigung wie ein Buch, Audibles sind immer richtig. TD/INT-Verh√§ltnis 3:1 oder besser. Clutch im 2-Minuten-Drill. Das ist das Gesicht der Franchise', topLeft: 'ü§î QB im K√§fig: Rating 100+, aber verlieren = QB macht alles richtig, aber einer allein kann nicht gewinnen. Verteidigung l√§sst 30+ Punkte zu oder Special Teams versagen. QB-Frustration w√§chst, k√∂nnte einen Trade fordern', bottomLeft: 'üòî Position #1 Problem: Rating <80 und Niederlagen = QB sieht das Feld nicht, h√§lt den Ball zu lange, trifft schlechte Entscheidungen. Viele abgef√§lschte B√§lle, Fumbles, Spielverz√∂gerung. Braucht einen neuen QB oder eine komplette Umstellung des Schemas', bottomRight: 'üí™ Defense wins championships: Siegen mit Rating <90 = Game Manager QB reicht aus, wenn die Verteidigung 3 Turnovers pro Spiel erzielt. Kurze, sichere P√§sse, keine heldenhaften W√ºrfe. Langweiliger, aber effektiver Football' } },
        { key: 'pass_int_pct', label: 'Interception Rate (%)', format: fmt2, higherBetter: false, help: 'Prozentsatz der Interceptions pro Passversuch. Niedriger Prozentsatz = guter Ballschutz, hoher = riskante Entscheidungen.', quadrantHelp: { topRight: '‚ö†Ô∏è Russisches Roulette: INT% >3%, aber siegen = Gunslinger-Mentalit√§t. QB wirft in enge Fenster, 50/50-B√§lle. Wenn es funktioniert ‚Äì spektakul√§r, wenn nicht ‚Äì Pick-Six. Fans bei jedem Spiel nerv√∂s', topLeft: 'üòî Weihnachtsmann f√ºr die Verteidigung: INT% >3.5% und verlieren = QB verteilt Geschenke. Starrt Receiver an, telegrafiert W√ºrfe, sieht den \'Robber\' in der Zone nicht. Jeder Drive ein potenzieller Turnover. Zukunft auf der Bank', bottomLeft: 'ü§î Zu vorsichtig?: INT% <1.5%, aber verlieren = QB spielt √§ngstlichen Football. Nur Checkdowns und sichere W√ºrfe. Kein Risiko = keine Big Plays. 3rd&long Conversions sind selten', bottomRight: 'üèÜ Chirurgische Pr√§zision: INT% <2% und Siege = QB sch√ºtzt den Ball wie einen Schatz. Wirft nur auf offene Receiver, wirft bei Druck ins Aus. Ballsicherheit = Jobsicherheit. Langweilig, aber effektiv' } },
        { key: 'sack_rate', label: 'Sack Rate (%)', format: fmt2, higherBetter: false, help: 'Prozentsatz der Sacks pro (Versuche + Sacks). Misst die Schutzqualit√§t der Offensive Line und die Mobilit√§t des QB.', quadrantHelp: { topRight: '‚ö†Ô∏è Houdini QB: Sack% >8%, aber siegen = QB ist ein Entfesselungsk√ºnstler oder das Schema kompensiert es. Viele Scrambles, kaputte Spielz√ºge werden zu Big Gains. O-Line h√§lt mit Ach und Krach, aber irgendwie funktioniert es', topLeft: 'üòî QB unter Belagerung: Sack% >9% und verlieren = Pocket kollabiert in 2 Sekunden. QB sieht mehr Gras als Himmel, Trikot ist zur Halbzeit schmutzig. Strip Sacks, Verletzungen warten nur darauf. O-Line braucht eine komplette √úberholung', bottomLeft: 'ü§î Festung ohne Siege: Sack% <4%, aber verlieren = O-Line gibt Zeit, aber QB nutzt sie nicht. H√§lt den Ball vielleicht zu lange oder WR werden nicht frei. Saubere Pocket verschwendet', bottomRight: 'üèÜ Gro√üe Mauer: Sack% <5% und Siege = O-Line wie ein Bunker. QB hat Zeit f√ºr einen Tee in der Pocket. Play Action ist t√∂dlich, 7-Step-Drops sind m√∂glich. Verteidigung ist frustriert, kommt nicht durch' } },
        { key: 'turnover_diff', label: 'Turnover Differential', format: fmt2, higherBetter: true, help: 'Differenz zwischen Ballgewinnen und Ballverlusten. Der st√§rkste Pr√§diktor f√ºr Siege ‚Äì positive Differenz = mehr Siege.', quadrantHelp: { topRight: 'üèÜ Mathematik des Sieges: +1.0 TO-Diff und Siege = Formel der Champions. Verteidigung erzwingt 2-3 Turnovers, Offense sch√ºtzt den Ball. Kurze Felder f√ºr die Offense, lange f√ºr den Gegner. Das ist eine Siegerkultur', topLeft: 'ü§î Statistische Anomalie: +TO-Diff, aber verlieren = extrem selten. Vielleicht passieren die Turnovers in der Garbage Time oder werden nicht in Punkte umgewandelt. Red-Zone-Effizienz-Problem oder Special-Teams-Katastrophen', bottomLeft: 'üòî Gro√üz√ºgigkeit t√∂tet: -TO-Diff und Niederlagen = klassische Korrelation. Schenken dem Gegner den Ball, k√∂nnen ihn nicht erobern. Jedes Spiel ein Kampf bergauf. Fundamentale Probleme mit der Ballsicherheit', bottomRight: 'üí™ Wunder der Disziplin: Siegen mit -TO-Diff = statistische Anomalie. Entweder eine unglaublich explosive Offense (TD alle 4 Plays) oder die Defense l√§sst <10 Punkte pro Spiel zu. Nicht nachhaltiges Modell' } },
        { key: 'td_per_play', label: 'TD per Play', format: fmt3, higherBetter: true, help: 'Touchdowns pro Spielzug. Misst die Effizienz in der Red Zone ‚Äì die F√§higkeit, Drives mit einem TD statt einem FG abzuschlie√üen.', quadrantHelp: { topRight: 'üèÜ TD-Fabrik: 0.06+ TD/Play und Siege = explosive Offense. Alle 17 Plays = Touchdown. Red Zone automatisch, Big Plays regelm√§√üig. Defense demoralisiert, Anzeigetafeln machen √úberstunden', topLeft: 'ü§î Punkte ohne Siege: Hohe TD-Rate, aber verlieren = punkten 35, kassieren 40. Verteidigung wie ein Schweizer K√§se oder Special-Teams-Katastrophen. Spannende Spiele, aber ein L in der Bilanz', bottomLeft: 'üòî Offensive An√§mie: <0.03 TD/Play und Niederlagen = k√∂nnen nicht in die Endzone kommen. Drives sterben in der Red Zone, begn√ºgen sich mit FG. Viele 3-and-Outs. Fans schlafen auf den Trib√ºnen ein', bottomRight: 'üí™ Bend don\'t break: Niedrige TD-Rate, aber siegen = Defense und Feldposition. Punkten 17, lassen 14 zu. H√§ssliche Siege z√§hlen auch. Ballkontrolle und Clock Management meisterhaft' } },
        { key: 'yds_per_play', label: 'Yards per Play', format: fmt2, higherBetter: true, help: 'Durchschnittliche Yards pro Spielzug (Pass + Lauf). Allgemeine Effizienz der Offense ‚Äì 5.5+ = gut, 6.0+ = exzellent.', quadrantHelp: { topRight: 'üèÜ Offensive Maschine: 6.0+ Y/P und Siege = jeder Snap ist gef√§hrlich. 1st Down = automatisch, 3rd&short normal. Regelm√§√üig gro√üe Yard-Brocken, Defense auf den Fersen. Anhaltende Drives zerm√ºrben den Gegner, TOP-Dominanz', topLeft: 'ü§î Leere Kalorien: 5.8+ Y/P, aber verlieren = zwischen den 20s eine Maschine, in der Red Zone stottert der Motor. Viele Yards, wenig Punkte. False Starts, Holdings t√∂ten Drives. Oder die Defense l√§sst 400+ Yards zu', bottomLeft: 'üòî 3-and-Out-Festival: <5.0 Y/P und Niederlagen = Offense wie im Schlamm. Negative Plays regelm√§√üig, 3rd&10+ ist Standard. Punter ist MVP des Teams. Defense 40+ Minuten auf dem Feld, im 4. Viertel ersch√∂pft', bottomRight: 'üí™ Effizienz > Volumen: Siegen mit <5.5 Y/P = brauchen keine 400 Yards, wenn die Defense 3 TOs erzwingt. Kurze Felder, Ballbesitzzeit, Field Goals. Langweilig, aber siegreich. Defense und Special Teams tragen das Team' } },
        { key: 'def_sacks_per_game', label: 'Defensive Sacks per Game', format: fmt2, higherBetter: true, help: 'Defense-Sacks pro Spiel. Zeigt den Druck auf den gegnerischen QB ‚Äì 2.5+ = guter Pass Rush, 3.0+ = exzellent.', quadrantHelp: { topRight: 'üèÜ Albtraum f√ºr QBs: 3.5+ Sacks/Spiel und Siege = Pass Rush unaufhaltsam. 4-Mann-Rush reicht, Blitz selten. Gegner-QB nerv√∂s vor dem Snap, \'Happy Feet\' in der Pocket. Strip Sacks √§ndern Spiele. Edge Rusher im Pro Bowl', topLeft: 'ü§î Verschwendeter Druck: 3+ Sacks, aber verlieren = kommen zum QB, aber regelm√§√üig Coverage-Pannen. Oder Offense 3-and-Out nach jedem Sack. Momentum wird nicht genutzt. Frustrierend f√ºr die D-Line', bottomLeft: 'üòî QB im Whirlpool: <2 Sacks/Spiel und Niederlagen = Gegner-QB kann in der Pocket ein Buch lesen. Max Protect nicht n√∂tig, 5 Receiver laufen bei jedem Down. D-Line unsichtbar, Blitz telegrafiert. Secondary ersch√∂pft', bottomRight: 'üí™ Coverage Sacks: Siegen mit <2.5 Sacks = Lockdown Coverage macht die Arbeit. QB h√§lt den Ball, hat niemanden zum Anwerfen. Verschleierte Coverages, Zonen-Disziplin. Nicht spektakul√§r, aber effektiv. Bend don\'t break' } },
        { key: 'def_ints_per_game', label: 'Defensive INTs per Game', format: fmt2, higherBetter: true, help: 'Defense-Interceptions pro Spiel. Das Erzwingen von Turnovers ist ein Schl√ºssel zum Sieg. 1.0+ = gut, 1.5+ = Elite-Defense.', quadrantHelp: { topRight: 'üèÜ No-Fly-Zone: 1.5+ INT/Spiel und Siege = Secondary wie Raubtiere. Ball-Hawk-Mentalit√§t, verschleierte Coverages funktionieren. Gegner-QB hat Angst, tief zu werfen. Pick-Six-Potenzial in jedem Spiel. DBs voller Selbstvertrauen', topLeft: 'ü§î Verschwendete Gelegenheiten: 1.3+ INT, aber verlieren = Defense erzwingt Turnovers, Offense setzt sie nicht um. 3-and-Out nach INT demoralisiert. Oder Offense gibt den Ball sofort zur√ºck. Momentum-Killer', bottomLeft: 'üòî H√§nde aus Stein: <0.7 INT/Spiel und Niederlagen = fallen gelassene INTs verfolgen sie. DBs k√∂nnen keinen Schnupfen fangen. Gegner-QB f√ºhlt sich wohl, 50/50-B√§lle werden zu 80/20. Keine spielver√§ndernden Aktionen von der Defense', bottomRight: 'üí™ Andere Wege: Siegen mit <1 INT/Spiel = erzwungene Fumbles, 4th-Down-Stops, Feldposition. Brauchen keine INTs, wenn die Offense die TOP kontrolliert. Lockdown-Defense in der Red Zone kompensiert' } },
        { key: 'pass_ints_per_game', label: 'INTs Thrown per Game', format: fmt2, higherBetter: false, help: 'Geworfene Interceptions pro Spiel. Niedriger Wert = guter Ballschutz. <1.0 = gut, <0.7 = exzellent.', quadrantHelp: { topRight: '‚ö†Ô∏è Gef√§hrlich leben: 1.5+ INT/Spiel, aber siegen = High-Risk/Reward-Philosophie. Explosive Plays kompensieren Turnovers. Defense rettet den QB regelm√§√üig. Herzschlag-Spiele jede Woche. Nicht nachhaltig', topLeft: 'üòî Eingepackte Niederlagen: 1.8+ INT/Spiel und Niederlagen = QB ist wie Oprah mit dem Ball. Erzwingt W√ºrfe in Deckung, Panikw√ºrfe, abgef√§lschte B√§lle. St√§ndige Momentum-Killer. Selbstvertrauen zerst√∂rt, Diskussionen √ºber Bankplatz', bottomLeft: 'ü§î Sicher, aber nutzlos: <0.8 INT/Spiel, aber verlieren = Captain Checkdown. Kein Risiko, keine Belohnung. Dink and Dunk dehnt das Feld nicht. Defense lauert auf kurze Routen. Vorhersehbar und ineffektiv', bottomRight: 'üèÜ Ballsicherheit gewinnt: <0.7 INT/Spiel und Siege = Entscheidungsfindung elite. Wegwerfen > Erzwingen. Mentalit√§t: f√ºr den n√§chsten Down leben. Vertrau dem Prozess. Langweilige Kritiker, gl√ºckliche Trainer. Meisterschaftsformel' } },
        { key: 'sacks_allowed_per_game', label: 'Sacks Allowed per Game', format: fmt2, higherBetter: false, help: 'Zugelassene Sacks pro Spiel. Misst die Schutzqualit√§t der O-Line. <2.0 = gut, <1.5 = Elite-Protection.', quadrantHelp: { topRight: '‚ö†Ô∏è QB-Magie rettet: 3+ Sacks/Spiel, aber siegen = QB wie Houdini oder schnelles Passspiel. Hot Routes, Rollouts, RPO neutralisieren den Rush. O-Line wie Dreht√ºren, aber das Schema kompensiert. Eis auf den Knien des QB nach dem Spiel', topLeft: 'üòî Dreht√ºr: 3.5+ Sacks/Spiel und Niederlagen = O-Line wie Luft. Blindside Hits regelm√§√üig, QB entwickelt PTBS. Medizinisches Personal besch√§ftigt, Backup-QB w√§rmt sich auf. Braucht eine komplette √úberholung der Linie', bottomLeft: 'ü§î Protection ohne Produktion: <1.5 Sacks, aber verlieren = O-Line gibt alle Zeit der Welt, aber QB liefert nicht. H√§lt den Ball ewig, verpasst Reads. Perfekter Schutz verschwendet. Oder WR schaffen keine Separation', bottomRight: 'üèÜ Fort Knox: <1.5 Sacks/Spiel und Siege = O-Line wie eine Betonmauer. QB hat sauberes Trikot nach dem Spiel. 7-Step-Drops, tief entwickelnde Routen m√∂glich. Pass Rusher demoralisiert, Schemata funktionieren nicht' } },
        { key: 'punts_per_game', label: 'Punts per Game', format: fmt2, higherBetter: false, help: 'Punts pro Spiel. Niedriger Wert = effiziente Offense mit anhaltenden Drives. <4.0 = gut, <3.5 = exzellent.', quadrantHelp: { topRight: '‚ö†Ô∏è Special Teams retten: 5+ Punts, aber siegen = Elite-Defense oder Feldpositions-Meisterschaft. Punter regelm√§√üig innerhalb der 20, Defense schafft kurze Felder. H√§sslicher, aber siegreicher Football. Punter f√ºr den Pro Bowl', topLeft: 'üòî Punt-Fest: 6+ Punts und Niederlagen = Offense kann keine Drives aufrechterhalten. 3-and-Out ist die Spezialit√§t des Hauses. Punter zur Halbzeit m√ºde. Defense ersch√∂pft von der st√§ndigen Arbeit. Offensive Coordinator auf dem hei√üen Stuhl', bottomLeft: 'ü§î Bewegung ohne Abschluss: <3.5 Punts, aber verlieren = zwischen den 20s gut, Red Zone Katastrophe. Oder Turnovers t√∂ten lange Drives. Bewegen den Ball, punkten aber nicht. Frustrierend f√ºr Fans', bottomRight: 'üèÜ Offensive Kontrolle: <3 Punts/Spiel und Siege = anhaltende Drives sind normal. Konvertieren 3rd Downs, kontrollieren die Uhr. Gegner-Defense selten auf dem Feld. TOP-Dominanz, physische Zerm√ºrbung. Punter ist der ausgeruhteste Spieler' } },
        { key: 'explosive_plays_per_game', label: '20+ Yard Plays per Game', format: fmt2, higherBetter: true, help: 'Spielz√ºge mit 20+ Yards pro Spiel. Explosive Momente halten Drives am Leben. 5+ = gut, 7+ = Elite-Playmaker.', quadrantHelp: { topRight: 'üèÜ Home-Run-Hitter: 7+ Explosive/Spiel und Siege = Defense kann nicht alles abdecken. Geschwindigkeit t√∂tet, Schema schafft Mismatches. Jeder Drive eine Bedrohung f√ºr einen TD in einem Spielzug. Momentum-Schwankungen regelm√§√üig. Highlight-Reel-Team', topLeft: 'ü§î Feuerwerk ohne Ende: 6+ Explosive, aber verlieren = Big Plays werden nicht umgesetzt. Nach 40-Yard-Gain ‚Äì Fumble oder INT. Oder die Defense l√§sst noch mehr explosive Plays zu. Viel L√§rm um nichts', bottomLeft: 'üòî Tod durch tausend Schnitte: <4 Explosive und Niederlagen = keine F√§higkeit, das Feld zu strecken. Defense komprimiert das Feld, 8 in der Box. Vorhersehbare, schwerf√§llige Offense. Fans checken w√§hrend der Drives ihre Handys', bottomRight: 'üí™ Systematischer Erfolg: Siegen mit <5 Explosive = methodischer Ansatz funktioniert. 4 Yards und eine Staubwolke, Ballkontrolle. Nicht spektakul√§r, aber effektiv. Defense ausgeruht, Uhr kontrolliert. Old-School-Sieg' } },
        { key: 'rush_broken_tackle_rate', label: 'Broken Tackles per Rush', format: fmt3, higherBetter: true, help: 'Prozentsatz gebrochener Tackles pro Lauf. Misst die Kraft und Beweglichkeit des RB. 0.10+ = gut, 0.15+ = Elite-Power.', quadrantHelp: { topRight: 'üèÜ Menschlicher Panzer: 0.15+ gebrochene Tackles und Siege = RB wie eine Abrissbirne. Arm-Tackles = extra Yards. Verteidiger prallen ab, brauchen Gang Tackling. Dominanz im 4. Viertel, wenn die Defense m√ºde ist. Physische Einsch√ºchterung', topLeft: 'ü§î Kraft im Vakuum: 0.13+ BT, aber verlieren = RB bricht Tackles, aber keine Bl√∂cke vor ihm. Individuelle Anstrengung reicht nicht. Oder Fumbles nach gebrochenen Tackles. Talent in einem schlechten Schema verschwendet', bottomLeft: 'üòî Fallen bei Ber√ºhrung: <0.08 BT und Niederlagen = RB wie eine Feder. Erster Kontakt = Down. Kein YAC, keine Power. Defense hat keine Angst, Arm-Tackles reichen. Braucht dringend einen Power Back', bottomRight: 'üí™ Schema > Power: Siegen mit <0.10 BT = muss keine Tackles brechen, wenn die L√ºcken riesig sind. Zone Blocking schafft Gassen, RB unber√ºhrt bis zum zweiten Level. Geschwindigkeit und Vision wichtiger als Kraft' } },
        { key: 'rush_yac_pct', label: 'Rush YAC %', format: fmt2, higherBetter: true, help: 'Prozentsatz der Yards nach Kontakt beim Laufen. Zeigt das physische Spiel des RB. 30%+ = gut, 35%+ = starker Runner.', quadrantHelp: { topRight: 'üèÜ Unaufhaltsame Kraft: 35%+ YAC und Siege = RB wie ein Bulldozer. Erster Kontakt = Aufw√§rmen. St√§ndiges Anschieben, zweiter Einsatz. Im 4. Viertel will die Defense nicht mehr tackeln. Physische Dominanz demoralisiert', topLeft: 'ü§î Held ohne Unterst√ºtzung: 33%+ YAC, aber verlieren = RB k√§mpft um jeden Yard, aber O-Line schafft keine anf√§nglichen L√ºcken. St√§ndig Kontakt im Backfield. Individuelle Brillanz bei einer Niederlage. Trade-Kandidat', bottomLeft: 'üòî Weicher Lauf: <25% YAC und Niederlagen = RB f√§llt bei der ersten Ber√ºhrung. Kein Kampf, kein Antrieb. Defense macht Arm-Tackles mit Selbstvertrauen. 3rd&short nicht automatisch. Braucht sofort einen Bruiser Back', bottomRight: 'üí™ Saubere L√ºcken: Siegen mit <30% YAC = O-Line dominiert so sehr, RB ist unber√ºhrt bis zum zweiten Level. Braucht kein YAC, wenn 5 Yards bis zum Kontakt frei sind. Perfekte Blocking-Schemata, RB wie ein hei√ües Messer durch Butter' } },
        { key: 'rec_yac_pct', label: 'Receiving YAC %', format: fmt2, higherBetter: true, help: 'Prozentsatz der Yards nach dem Catch (YAC). F√§higkeit der Receiver, Yards nach dem Fang zu kreieren. 40%+ = dynamische WR.', quadrantHelp: { topRight: 'üèÜ YAC-Monster: 45%+ YAC und Siege = WR verwandeln 5-Yard-Slants in 20-Yard-Gains. St√§ndig verpasste Tackles, Kn√∂chel werden regelm√§√üig gebrochen. Screens und Crosses sind t√∂dlich. Defense muss Receiver im Pulk tackeln. Game Breaker', topLeft: 'ü§î YAC, aber kein W: 42%+ YAC, aber verlieren = Receiver kreieren nach dem Catch, aber QB ist ungenau oder Schema ist vorhersehbar. Gro√üartige individuelle Leistungen in einem verlierenden System. YAC-Yards in der Garbage Time helfen nicht', bottomLeft: 'üòî Fangen und Fallen: <35% YAC und Niederlagen = WR fangen und sind sofort am Boden. Keine Moves, keine Power. Defense spielt eng, da sie wei√ü, dass nach dem Catch keine Gefahr droht. Possession Receiver ohne Possession Wins', bottomRight: 'üí™ Vertikale Bedrohung: Siegen mit <38% YAC = tiefe B√§lle, bei denen YAC nicht n√∂tig ist. Fangen im vollen Lauf f√ºr TDs. Go Routes und Posts dominieren. Braucht kein YAC, wenn der Ball in der Endzone ist. Vertikales Strecken des Feldes' } },
        { key: 'pass_comp_pct', label: 'Completion %', format: fmt2, higherBetter: true, help: 'Prozentsatz der abgeschlossenen P√§sse. Genauigkeit des QB und Schema der Offense. 65%+ = gut, 70%+ = Elite-Genauigkeit.', quadrantHelp: { topRight: 'üèÜ Chirurgische Pr√§zision: 70%+ Completion und Siege = QB wie ein Chirurg. Ballplatzierung ideal, Timing tadellos. WR m√ºssen sich nicht anpassen. Rhythmus-Passspiel vom Feinsten. Defense kann Timing nicht st√∂ren. Maschinenartige Effizienz', topLeft: 'ü§î Leere Completions: 68%+, aber verlieren = Dink and Dunk dehnt die Defense nicht. 3-Yard-P√§sse bei 3rd&8. Statistik-Polsterung ohne Wirkung. Defense gibt kurze P√§sse her, nimmt explosive weg. Hoher Prozentsatz, geringe Wirkung', bottomLeft: 'üòî Spray and Pray: <58% Completion und Niederlagen = QB und WR nicht auf einer Wellenl√§nge. B√§lle segeln, springen, hinter Receiver. Timing stimmt nicht, Chemie fehlt. St√§ndige Drive-Killer. QB-Trainer macht √úberstunden', bottomRight: 'üí™ Boom oder Bust: Siegen mit <62% = niedriger Prozentsatz, aber hohe Belohnung. Tiefe W√ºrfe funktionieren oft genug. 3 Incompletions, dann ein 60-Yard-TD. Defense kann nicht auf Routen lauern. Explosiv > Effizient in diesem System' } },
        { key: 'pass_td_pct', label: 'TD Rate (%)', format: fmt2, higherBetter: true, help: 'Prozentsatz der Touchdowns pro Passversuch. Effizienz in der Red Zone durch die Luft. 5%+ = gut, 6%+ = Elite-Scoring.', quadrantHelp: { topRight: 'üèÜ Red-Zone-Attent√§ter: 6.5%+ TD-Rate und Siege = jeder Drive eine Bedrohung f√ºr 6 Punkte. Red Zone = automatisch. Fade Routes, Back Shoulders sind Gold wert. QB-WR-Chemie in der Endzone elite. Defense in der Red Zone panisch', topLeft: 'ü§î TDs ohne Ergebnis: 6%+ TD-Rate, aber verlieren = Offense punktet, aber Defense blutet Punkte. Oder Special-Teams-Katastrophen. Punkten 35, kassieren 40. Aufregende Spiele, entt√§uschende Ergebnisse. Kein komplement√§rer Football', bottomLeft: 'üòî FG-Brigade: <3.5% TD-Rate und Niederlagen = begn√ºgen sich st√§ndig mit 3. Red Zone = FG-Zone. K√∂nnen ihn nicht reinbringen. Fade Routes unvollst√§ndig, Slants gedeckt. Kicker ist der meistbesch√§ftigte Spieler. Punkte auf dem Feld gelassen', bottomRight: 'üí™ Rush-TD-Dominanz: Siegen mit <4.5% TD-Rate = Laufspiel in der Red Zone unaufhaltsam. Power Formations, QB Sneaks. Brauchen keine Passing TDs, wenn der RB ihn aus 5 Yards reinst√∂√üt. Physische Dominanz in der Scoring Zone' } },
        { key: 'drop_rate', label: 'Drop Rate (%)', format: fmt2, higherBetter: false, help: 'Prozentsatz der fallen gelassenen P√§sse. Zuverl√§ssigkeit der Receiver-Truppe. <5% = gute H√§nde, <3% = Elite-H√§nde.', quadrantHelp: { topRight: '‚ö†Ô∏è Siegen trotz Drops: 6%+ Drops, aber siegen = Volumen-Passspiel kompensiert. QB wirft 40+ Mal, einige Drops unvermeidlich. Oder Defense schafft st√§ndig kurze Felder. Spielen trotz Widrigkeiten', topLeft: 'üòî Butterfinger-Epidemie: 7%+ Drops und Niederlagen = WR-Raum-Katastrophe. Drive-t√∂tende Drops, 3rd-Down-Drops, Red-Zone-Drops. QB verliert Vertrauen, beginnt, in enge Fenster zu zwingen. Ballmaschine braucht √úberstunden', bottomLeft: 'ü§î Klebeh√§nde ohne Siege: <3% Drops, aber verlieren = WR fangen alles, aber wenig Gelegenheiten. QB ungenau oder O-Line gibt keine Zeit. Perfekte H√§nde in kaputtem System verschwendet', bottomRight: 'üèÜ Zuverl√§ssige Waffen: <3.5% Drops und Siege = Vertrauen zwischen QB und WR absolut. Umk√§mpfte Catches werden gemacht, schwierige Catches Routine. QB wei√ü ‚Äì wenn WR ihn ber√ºhrt hat, hat er ihn gefangen. Meisterschafts-Zuverl√§ssigkeit' } },
        { key: 'pass_rush_ratio', label: 'Pass/Rush Ratio', format: fmt2, higherBetter: null, help: 'Verh√§ltnis von P√§ssen zu L√§ufen. 1.5 = ausgewogen. >2.0 = passlastig, <1.2 = lauflastige Offense.', quadrantHelp: { topRight: 'üèà Air-Raid-Champions: Ratio >2.2 und Siege = moderner Passangriff dominiert. 65/35-Split funktioniert. Defense kann die Box nicht vollpacken. Quick Game, RPO, Spread Formations. Passen, um den Lauf vorzubereiten', topLeft: 'ü§î Aufgegebene Balance: Ratio >2.5, aber verlieren = spielen st√§ndig von hinten. Gezwungen zu passen, Defense wei√ü es. Lauf-Yards <80/Spiel. Vorhersehbar, eindimensional. O-Line ersch√∂pft vom Pass Blocking', bottomLeft: 'üí™ Ground-Pound-Kampf: Ratio <1.2 und Niederlagen = versuchen, den Lauf zu etablieren, scheitern aber. 8-9 in der Box, kein Platz zum Laufen. QB wird nicht vertraut oder ist verletzt. Steinzeit-Football ohne Erfolg', bottomRight: 'üèÜ Smashmouth-Gewinner: Ratio <1.3 und Siege = Old-School-Dominanz. 200+ Lauf-Yards/Spiel. Kontrollieren die Uhr, zerm√ºrben die Defense. Das 4. Viertel geh√∂rt ihnen. Power Football funktioniert immer noch' } },
        { key: 'off_yds_per_game', label: 'Offensive Yards per Game', format: fmt2, higherBetter: true, help: 'Gesamt-Yards der Offense pro Spiel. 350+ = gut, 400+ = Elite-Offense. Produktionsvolumen.', quadrantHelp: { topRight: 'üèÜ Yardage-Maschine: 400+ Yards/Spiel und Siege = Offense unaufhaltsam. Bewegen die Ketten nach Belieben, Defense immer auf den Fersen. Mehrere 100-Yard-Receiver/Rusher. Totale Dominanz zwischen den 20s und in der Red Zone', topLeft: 'ü§î Leere Yards: 380+ Yards, aber verlieren = zwischen den 20s G√∂tter, in der Red Zone Bauern. Oder Defense l√§sst 450+ zu. Bewegen den Ball √ºberall, au√üer da, wo es z√§hlt. FGs statt TDs. Frustrierende Produktivit√§t', bottomLeft: 'üòî Offensive W√ºste: <300 Yards und Niederlagen = k√∂nnen den Ball nicht konsistent bewegen. Mehrere 3-and-Outs, Feldpositionsk√§mpfe verloren. Defense 35+ Minuten auf dem Feld. Offensive Coordinator aktualisiert seinen Lebenslauf', bottomRight: 'üí™ Bend-don\'t-break-Siege: Siegen mit <330 Yards = Effizienz √ºber Volumen. Kurze Felder durch Turnovers, brauchen keine 80-Yard-Drives. Defense dominiert, Special Teams exzellent. Punkte > Yards-Philosophie' } },
        { key: 'punt_avg', label: 'Punt Average (Yards)', format: fmt2, higherBetter: true, help: 'Durchschnittliche Punt-Distanz. Kraft des Punter-Beins. 45+ = gut, 47+ = Elite-Bein.', quadrantHelp: { topRight: 'üèÜ Waffen-Punter: 47+ Avg und Siege = Feldpositions-Waffe. Dreht das Feld regelm√§√üig, 60+ Yarder bei Bedarf. Coverage-Team auch exzellent. Champion der versteckten Yards. Special-Teams-Coordinator-Genie', topLeft: 'ü§î Verschwendetes Bein: 46+ Avg, aber verlieren = gro√üartiger Punter, schreckliche Offense. Puntet st√§ndig von der eigenen 20. Lange Punts, aber Defense h√§lt nicht. Individuelle Exzellenz bei einer Niederlage. Trade-Wert hoch', bottomLeft: 'üòî Probleme mit schwachem Bein: <42 Avg und Niederlagen = verschenken Feldposition. Kurze Punts, schlechte Hang Time. Returns t√∂ten das Team. Netto-Durchschnitt noch schlechter. Punter-Tryouts sofort n√∂tig', bottomRight: 'üí™ Punten sowieso selten: Siegen mit <43 Avg = wen interessiert der Punt-Durchschnitt, wenn man 2 Mal/Spiel puntet? Gehen bei 4th Down daf√ºr, punkten TDs. Punter ist der frischeste Spieler. Offensive Effizienz macht Punten irrelevant' } },
        { key: 'punt_net_avg', label: 'Punt Net Average (Yards)', format: fmt2, higherBetter: true, help: 'Netto-Durchschnitt (unter Ber√ºcksichtigung von Returns). Echter Einfluss auf die Feldposition. 40+ = gut, 42+ = Elite-Platzierung.', quadrantHelp: { topRight: 'üèÜ Versteckte Yards gewinnen: 42+ Netto und Siege = Punt-Team-Exzellenz. Punter bombt ihn, Coverage schw√§rmt aus, keine Returns. Gegner startet regelm√§√üig innerhalb der 20. Feldposition wie der 12. Spieler. Special-Teams-Stolz', topLeft: 'ü§î Gro√üartiges Punten verschwendet: 41+ Netto, aber verlieren = Punter und Coverage exzellent, aber punten 7+ Mal. Offense kann keine Drives aufrechterhalten. Defense gibt lange Felder trotzdem auf. Erfolg einer einzelnen Einheit im Teamversagen', bottomLeft: 'üòî Return-Katastrophe: <37 Netto und Niederlagen = Punts kurz oder Returns t√∂ten. Coverage-Team langsam, Gassen offen. Geben 10+ Yards pro Return ab. Bluten bei versteckten Yards. Special-Teams-Trainer gefeuert', bottomRight: 'üí™ Punkten statt Punten: Siegen mit <38 Netto = wen interessiert Netto-Punting, wenn man bei 4th Down daf√ºr geht? Punten selten, oft in der gegnerischen H√§lfte. Aggressive Philosophie funktioniert. Punter ist der einsamste Spieler' } },
        { key: 'punts_in_20_pct', label: 'Punts Inside 20 (%)', format: fmt2, higherBetter: true, help: 'Prozentsatz der Punts innerhalb der 20-Yard-Linie. Platzierungsgenauigkeit ‚Äì Coffin-Corner-Punting. 40%+ = gut, 50%+ = elite.', quadrantHelp: { topRight: 'üèÜ Coffin-Corner-K√ºnstler: 50%+ innerhalb 20 und Siege = Punter-Chirurg bei der Ballplatzierung. Eck-Kicks, Backspin-Meisterschaft. Gegner startet st√§ndig tief. Safety-Potenzial in jeder Serie. Waffe, nicht nur Bein', topLeft: 'ü§î Pr√§zision ohne Zweck: 45%+ innerhalb 20, aber verlieren = gro√üartiges Gef√ºhl, aber punten aus der eigenen H√§lfte. Wenig lange Feld-Punts. Defense profitiert nicht von der Feldposition. Verschwendete F√§higkeit', bottomLeft: 'üòî Touchback-Maschine: <30% innerhalb 20 und Niederlagen = Punter nur Kraft, kein Gef√ºhl. Segelt in die Endzone, Gegner automatisch auf der 20. Kein Pin-Potenzial. Directional Punting existiert nicht. Coaching-Problem', bottomRight: 'üí™ TD > Punts: Siegen mit <35% innerhalb 20 = punten selten und meist aus der Tiefe. Gehen bei 4th Down in der gegnerischen H√§lfte daf√ºr. Brauchen keine Coffin Corner, wenn sie TDs punkten. Aggressiv gewinnt' } },
        { key: 'fg_pct', label: 'Field Goal %', format: fmt2, higherBetter: true, help: 'Prozentsatz der getroffenen Field Goals. Zuverl√§ssigkeit des Kickers. 85%+ = gut, 90%+ = Elite-Kicker.', quadrantHelp: { topRight: 'üèÜ Automatischer Kicker: 90%+ FG und Siege = Gold wert im Clutch. Jede Distanz in Reichweite = 3 Punkte. Defense wei√ü ‚Äì nicht √ºber die 35 lassen. Absolutes Vertrauen, Holder-Kicker-Chemie perfekt. Macht den Unterschied', topLeft: 'ü§î Kicker-Exzellenz verschwendet: 88%+ FG, aber verlieren = Kicker perfekt, aber wenig Versuche. Offense kommt nicht in Reichweite oder geht 3-and-Out. Oder Red Zone = TD f√ºr Gegner. Individuelle Brillanz reicht nicht', bottomLeft: 'üòî √úberall Punkte liegengelassen: <75% FG und Niederlagen = verpasste Chip Shots, verpasste Game Winner. Selbstvertrauen ersch√ºttert, Holder-Kicker-Probleme. Jeder Versuch ein Abenteuer. Verlieren Spiele mit FG-Differenz. Tryouts am Montag', bottomRight: 'üí™ TDs statt FGs: Siegen mit <80% FG = wer braucht FGs, wenn man TDs punktet? Red Zone = 7 Punkte. Begn√ºgen sich selten mit 3. FG-Versuche nur aus weiter Distanz aus Verzweiflung. Kicker rostet ein' } },
        { key: 'fg_50plus_pct', label: '50+ Yard FG %', format: fmt2, higherBetter: true, help: 'Prozentsatz der Treffer aus 50+ Yards. Beinst√§rke auf gro√üe Distanzen. 50%+ = gut, 70%+ = Elite-Reichweite.', quadrantHelp: { topRight: 'üèÜ Langstrecken-Scharfsch√ºtze: 70%+ aus 50+ und Siege = Waffe, nicht nur Kicker. √Ñndert Defensivstrategie ‚Äì m√ºssen bis zur 40-Yard-Linie verteidigen. Versuche am Ende der Halbzeit/des Spiels automatisch. Wind kein Faktor. Psychologischer Vorteil', topLeft: 'ü§î Distanz ohne Siege: 60%+ aus 50+, aber verlieren = tolles Bein, aber selten in Position. Oder macht lange FGs, aber Gegner punktet TDs. Beeindruckende F√§higkeit bei einer Niederlage. Highlight-Reel ohne Einfluss auf die Anzeigetafel', bottomLeft: 'üòî Keine Reichweite: <30% aus 50+ und Niederlagen = kein Vertrauen √ºber 45. Konservatives Play Calling nahe der Mittellinie. Punten statt versuchen. Lassen Punkte liegen, wenn verzweifelt. Begrenzte offensive Possessions', bottomRight: 'üí™ Nahdistanz-Dominanz: Siegen mit <40% aus 50+ = brauchen keine langen FGs, wenn die Offense effizient ist. Immer n√§her als 45 Yards oder punkten TDs. Kurze Felder durch Defense/ST. Distanz-Kicking irrelevant' } },
        { key: 'xp_pct', label: 'Extra Point %', format: fmt2, higherBetter: true, help: 'Prozentsatz der getroffenen Extra Points. Sollte 95%+ sein. Darunter = Probleme unter Druck oder Technik.', quadrantHelp: { topRight: 'üèÜ PAT-Maschine: 98%+ XP und Siege = automatisch nach TDs. Lassen nie Punkte liegen. Ablauf reibungslos ‚Äì Snap, Hold, Kick wie ein Uhrwerk. Mentaler Vorteil ‚Äì Gegner wei√ü, keine geschenkten Punkte. Meisterschaftsdetails', topLeft: 'ü§î Perfekt, aber sinnlos: 97%+ XP, aber verlieren = Kicker perfekt, aber wenig TDs zum Konvertieren. Oder Gegner punktet mehr. Macht XPs in der Garbage Time. Individuelle Konstanz bei Team-Inkonsistenz', bottomLeft: 'üòî Yips-Krise: <92% XP und Niederlagen = verpassen \'Gimmes\'. Verlieren regelm√§√üig mit 1-2 Punkten. Snap/Hold/Kick-Timing stimmt nicht. Mentale Blockade entwickelt. Gehen √∂fter aus Verzweiflung f√ºr 2. Montag Tryouts', bottomRight: 'üí™ H√§ssliche Siege: Siegen mit <94% XP = verpasste XPs, aber gewinnen mit 10+. Defense oder Offense so dominant, dass verpasste Punkte egal sind. Oder gehen erfolgreich f√ºr 2. Fehlermarge vorhanden' } },
      ];

    async function loadData() {
      const stats = await tryCsv([
        '../output/team_aggregated_stats.csv',
        'output/team_aggregated_stats.csv',
        '/output/team_aggregated_stats.csv'
      ]);

      for (const row of stats) {
        row.logoUrl = (row.logoId !== '' && row.logoId != null) ? 
          `https://cdn.neonsportz.com/teamlogos/256/${row.logoId}.png` : null;
      }

      return stats;
    }

    function drawScatter(holder, rows, metric) {
      const metricKey = metric.key;

      const data = rows.filter(d => 
        Number.isFinite(+d.win_pct) && 
        Number.isFinite(+d[metricKey]) &&
        +d.win_pct >= 0.005 && +d.win_pct <= 0.995
      );

      if (data.length < 2) return;

      const panel = holder.append('details').attr('class', 'panel').attr('open', true);
      const summary = panel.append('summary');
      summary.append('span').text(`${metric.label} vs Win%`);
      
      if (metric.help) {
        const helpIcon = summary.append('span').attr('class', 'help-icon').text('?');
        const metricTip = d3.select('body').append('div').attr('class', 'metric-tooltip').style('display', 'none');
        helpIcon.on('mouseenter', function(evt) {
          metricTip.style('display', 'block').html('<strong>' + metric.label + ':</strong><br>' + metric.help);
        }).on('mousemove', (evt) => {
          metricTip.style('left', (evt.pageX + 12) + 'px').style('top', (evt.pageY - 28) + 'px');
        }).on('mouseleave', () => {
          metricTip.style('display', 'none');
        });
      }

      const margin = { top: 20, right: 24, bottom: 46, left: 70 };
      const width = 1080, height = 480;
      const innerW = width - margin.left - margin.right;
      const innerH = height - margin.top - margin.bottom;

      const wrap = panel.append('div').attr('class', 'chart-wrap');
      const svg = wrap.append('svg').attr('width', width).attr('height', height);
      const g = svg.append('g').attr('transform', `translate(${margin.left},${margin.top})`);

      const yVals = data.map(d => +d[metricKey]);
      const yMin = d3.min(yVals), yMax = d3.max(yVals);
      const yRange = yMax - yMin;
      const yPad = yRange * 0.15 || 0.5;
      const y = d3.scaleLinear()
        .domain([yMin - yPad, yMax + yPad])
        .range([innerH, 0]);

      const xVals = data.map(d => +d.win_pct);
      const xMin = d3.min(xVals), xMax = d3.max(xVals);
      const xPad = (xMax - xMin) * 0.1 || 0.05;
      const x = d3.scaleLinear()
        .domain([Math.max(0, xMin - xPad), Math.min(1, xMax + xPad)])
        .range([0, innerW]);

      const tickValues = [0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9].filter(v =>
        v >= x.domain()[0] && v <= x.domain()[1]
      );

      g.append('g').attr('transform', `translate(0,${innerH})`)
        .call(d3.axisBottom(x).tickValues(tickValues).tickFormat(toPct).tickSize(-innerH).tickPadding(8))
        .call(s => s.selectAll('.tick line').attr('stroke', '#e2e2e2'))
        .call(s => s.select('.domain').attr('stroke', '#9aa0a6'));

      const yTickCount = 10;
      g.append('g')
        .call(d3.axisLeft(y).ticks(yTickCount).tickFormat(metric.format).tickSize(-innerW).tickPadding(6))
        .call(s => s.selectAll('.tick line').attr('stroke', '#efefef'))
        .call(s => s.select('.domain').attr('stroke', '#dcdcdc'));

      const yAvg = d3.mean(yVals), xAvg = d3.mean(xVals);
      g.append('line').attr('x1', 0).attr('x2', innerW).attr('y1', y(yAvg)).attr('y2', y(yAvg))
        .attr('stroke', '#999').attr('stroke-dasharray', '6,4').attr('stroke-width', 1.5);
      g.append('line').attr('x1', x(xAvg)).attr('x2', x(xAvg)).attr('y1', 0).attr('y2', innerH)
        .attr('stroke', '#9aa0a6').attr('stroke-dasharray', '6,4').attr('stroke-width', 1.5);
      g.append('text').attr('x', 6).attr('y', y(yAvg)-6).attr('fill', '#555').attr('font-size', 11)
        .text('Avg Y: ' + metric.format(yAvg));
      g.append('text').attr('x', x(xAvg)+6).attr('y', 12).attr('fill', '#555').attr('font-size', 11)
        .text('Avg X: ' + toPct(xAvg));

      const { m, b, r2 } = regression(data.map(d => [+d.win_pct, +d[metricKey]]));
      const xRange = [d3.min(xVals), d3.max(xVals)];
      g.append('line')
        .attr('x1', x(xRange[0])).attr('y1', y(m*xRange[0] + b))
        .attr('x2', x(xRange[1])).attr('y2', y(m*xRange[1] + b))
        .attr('stroke', '#777').attr('stroke-width', 2).attr('opacity', .95);

      const tip = d3.select('body').append('div').attr('class', 'tooltip').style('display', 'none');

      const size = 30;
      const node = g.selectAll('.team').data(data, d => d.team).join('g').attr('class', 'team')
        .attr('transform', d => `translate(${x(d.win_pct)},${y(d[metricKey])})`)
        .on('mouseenter', function(evt, d){
          const trend = m * d.win_pct + b;
          const res = d[metricKey] - trend;
          let html = `<strong>${d.team}</strong><br>`;
          html += `${metric.label}: ${metric.format(d[metricKey])}<br>`;
          html += `Win%: ${toPct(d.win_pct)}<br>`;
          html += `Œî vs trend: ${(res>=0?'+':'') + metric.format(res)}<br>`;
          
          const qx = +d.win_pct >= xAvg;
          const qy = +d[metricKey] >= yAvg;
          let quadrant = '';
          
          if (metric.quadrantHelp) {
        	    if (qx && qy) quadrant = '<em>' + metric.quadrantHelp.topRight + '</em>';
        	    else if (!qx && qy) quadrant = '<em>' + metric.quadrantHelp.topLeft + '</em>';
        	    else if (!qx && !qy) quadrant = '<em>' + metric.quadrantHelp.bottomLeft + '</em>';
        	    else quadrant = '<em>' + metric.quadrantHelp.bottomRight + '</em>';
        	} else if (metric.higherBetter === true) {
        	    if (qx && qy) quadrant = '<em>‚úÖ Winning + good metric score</em>';
        	    else if (!qx && qy) quadrant = '<em>ü§î Good metric, but few wins - something else is missing</em>';
        	    else if (!qx && !qy) quadrant = '<em>üòî Losing + weak metric - improvements needed</em>';
        	    else quadrant = '<em>üí™ Winning despite a weak metric - compensating in other areas</em>';
        	} else if (metric.higherBetter === false) {
        	    if (qx && qy) quadrant = '<em>‚ö†Ô∏è Winning despite a high negative indicator</em>';
        	    else if (!qx && qy) quadrant = '<em>üòî High negative indicator + few wins - double problem</em>';
        	    else if (!qx && !qy) quadrant = '<em>ü§î Low negative, but few wins - problems elsewhere</em>';
        	    else quadrant = '<em>‚úÖ Low negative + many wins - the right approach</em>';
        	} else {
        	    if (qx && qy) quadrant = '<em>Top right: high Win%, high metric</em>';
        	    else if (!qx && qy) quadrant = '<em>Top left: low Win%, high metric</em>';
        	    else if (!qx && !qy) quadrant = '<em>Bottom left: low Win%, low metric</em>';
        	    else quadrant = '<em>Bottom right: high Win%, low metric</em>';
        	}
        	html += quadrant;
          
          tip.style('display','block').html(html);
        })
        .on('mousemove', (evt)=> tip.style('left', (evt.pageX+12)+'px').style('top',(evt.pageY-28)+'px'))
        .on('mouseleave', ()=> tip.style('display','none'));

      node.append('rect')
        .attr('x', -(size/2 + 2)).attr('y', -(size/2 + 2))
        .attr('width', size + 4).attr('height', size + 4)
        .attr('rx', 4).attr('ry', 4)
        .attr('fill', d => {
          const predicted = m * d.win_pct + b;
          const above = +d[metricKey] >= predicted;
          return (metric.higherBetter !== false && above) || (metric.higherBetter === false && !above) ? 
            'var(--red)' : 'var(--blue)';
        })
        .attr('opacity', .16);

      node.append('image')
        .attr('href', d => d.logoUrl || null)
        .attr('x', -size/2).attr('y', -size/2)
        .attr('width', size).attr('height', size)
        .attr('opacity', .95);

      svg.append('text').attr('x', margin.left + innerW/2).attr('y', height-10)
        .attr('text-anchor', 'middle').attr('fill', '#444').attr('font-size', 12)
        .text('Win Percentage');
      svg.append('text').attr('transform', `translate(14, ${margin.top + innerH/2}) rotate(-90)`)
        .attr('text-anchor', 'middle').attr('fill', '#444').attr('font-size', 12)
        .text(metric.label);

      const legend = panel.append('div').attr('class', 'legend');
      legend.append('span').html(`<span class="swatch red"></span> Better than trend`);
      legend.append('span').html(`<span class="swatch blue"></span> Worse than trend`);
      legend.append('span').html(`<span class="swatch avg"></span> Average Lines`);

      let corrClass = 'corr-weak', corrLabel = 'Weak';
      if (r2 >= 0.5) { corrClass = 'corr-strong'; corrLabel = 'Strong'; }
      else if (r2 >= 0.25) { corrClass = 'corr-moderate'; corrLabel = 'Moderate'; }
      
      summary.append('span').attr('class', `correlation-badge ${corrClass}`)
        .style('margin-left', '12px')
        .html(`R¬≤=${fmt3(r2)} (${corrLabel})`);
    }

    function render() {
      loadData().then(allRows => {
        const root = d3.select('#root');
        
        METRICS.forEach(metric => {
          drawScatter(root, allRows, metric);
        });
      }).catch(err => {
        d3.select('#root').append('div').style('color','crimson').text('Failed to load data: '+err);
        console.error(err);
      });
    }

    window.addEventListener('DOMContentLoaded', render);
  </script>
</head>
<body>
  <div class="container">
    <h1>Team Statistics Explorer ‚Äî Win% Correlations</h1>
    <div class="subtitle">
      28 comprehensive graphs showing how different team metrics correlate with winning percentage. 
      Red squares = better than expected for their win%, Blue = worse than expected.
      R¬≤ shows correlation strength (0=none, 1=perfect).
    </div>
    <div id="root"></div>
    <div class="subtitle">Data: stats_scripts/output/team_aggregated_stats.csv (aggregated from MZ_*.csv files)</div>
  </div>
</body>
</html>
